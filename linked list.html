<script src='https://d3js.org/d3.v4.min.js'></script>




<!-- highlighting arrows -->

<svg height="1000" width="1000">
  <defs>
    <marker id="arrowhead" viewBox="0 0 10 10" refX="5" refY="5" 
            markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
  </defs>
</svg>


<script>
  var nodes = [6,4,1,9,3];
  visusaliseNewNode(true);
  var currIndex = 2;


  function visualiseRemovedNode() {
  // Find the index of the removed node
  var removedIndex = -1;
  var newNodes = d3.selectAll('.node').data();
  for (var i = 0; i < newNodes.length; i++) {
    if (nodes.indexOf(newNodes[i]) === -1) {
      removedIndex = i;
      break;
    }
  }

  // Remove the <g> element corresponding to the removed node
  d3.select('svg')
    .selectAll('.node')
    .filter(function(d, i) { return i === removedIndex; })
    .remove();
    
// Remove the arrow pointing to the removed node
if (removedIndex === 0) {
  d3.select('svg')
    .selectAll('.node')
    .filter(function(d, i) { return i === removedIndex; })
    .select('line')
    .remove();
}

  // Move all nodes and arrows after the removed node to the left
  d3.selectAll('.node')
    .attr('transform', function(d, i) {      
        return 'translate(' + i * 100 + ',0)';
    });
}




function visusaliseNewNode(isFirstRender) {
  node = d3.select('svg')
  .selectAll('.node')
  .data(nodes)
  .enter()
  .append('g')
      .attr('class', 'node')
      .attr('transform', function(d, i) {
        return 'translate(' + i * 100 + ',0)';
      });

  // Append a new <circle> element to each <g> element
  node.append('circle')
      .attr('cx', 50)
      .attr('cy', 50)
      .attr('r', 40)
      .attr('stroke', 'blue')
      .attr('stroke-width', 3)
    //   .attr('fill', 'cyan')

      .attr('fill', function(d, i) {
      return i === currIndex ? 'cyan' : 'white';
    });
    

  // Append a new <text> element to each <g> element
  node.append('text')
      .attr('text-anchor', 'middle')
      .attr('fill', 'black')
      .attr('dy', '0.3em') // Adjust the vertical position of text
      .attr('x', 50) // Position the text inside the circle
      .attr('y', 50)
      .attr('font-family', 'Arial')
      .attr('font-size', 30)
      .text(function(d) { return d; });

  // Add an arrow between the previous node and the current node
  node.filter(function(d, i) { return !isFirstRender || i !== 0; }) // Don't add a line before the first node
    .append('line')
      .attr('x1', -9)
      .attr('y1', 50)
      .attr('x2', 8)
      .attr('y2', 50)
      .attr('stroke', 'black')
      .attr('marker-end', 'url(#arrowhead)');
}

function highlightNode(index, colour) {
  node.data(nodes)
  .select('circle')
  .attr('fill', function(d, i) {
    return i === index ? colour : 'white';
  });
}



// Mock data changes
setTimeout(() => {
  highlightNode(1, 'cyan');
}, 1000)


setTimeout(() => {
  console.log(nodes);
  nodes.splice(1,1);
  console.log(nodes);
  visualiseRemovedNode();
}, 1500)


// setTimeout(() => {
//   nodes.push(20);
//   visusaliseNewNode(false);
// }, 2000)

// setTimeout(() => {
//   nodes.push(50);
//   nodes.push(51);
//   nodes.push(52);
//   visusaliseNewNode(false);
// }, 3000)


</script>



</body>
</html>
